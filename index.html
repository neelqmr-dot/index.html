<!DOCTYPE html>
<html lang="hi" manifest="manifest.json">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .app-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
            width: 100%;
            max-width: 450px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .login-form {
            display: block;
        }
        
        .login-form.hidden,
        .main-app.hidden {
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        input[type="tel"], input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="tel"]:focus, input[type="text"]:focus, input[type="number"]:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .worker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }
        
        .worker-name {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .daily-wage {
            font-size: 14px;
            color: #718096;
        }
        
        .attendance-row {
            display: grid;
            grid-template-columns: 80px 80px 100px 1fr;
            gap: 10px;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .attendance-row:last-child {
            border-bottom: none;
        }
        
        .date-cell {
            font-size: 14px;
            font-weight: 500;
        }
        
        .attendance-input {
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            text-align: center;
            width: 100%;
        }
        
        .expense-input {
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            text-align: center;
        }
        
        .balance-cell {
            text-align: right;
            font-weight: 600;
            color: #38a169;
        }
        
        .summary-section {
            margin-top: 20px;
            padding: 15px;
            background: #edf2f7;
            border-radius: 10px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .summary-row:last-child {
            margin-bottom: 0;
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            border-top: 1px solid #cbd5e0;
            padding-top: 8px;
        }
        
        .payment-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0fff4;
            border-radius: 10px;
            border: 1px solid #9ae6b4;
        }
        
        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .payment-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #38a169;
            background: white;
            color: #38a169;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .payment-btn.active {
            background: #38a169;
            color: white;
        }
        
        .upi-section {
            margin-top: 15px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .nav-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .nav-btn.active {
            background: #667eea;
            color: white;
        }
        
        .worker-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .worker-item {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .worker-item:hover {
            background: #f7fafc;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }
        
        .worker-item.active {
            background: #edf2f7;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }
        
        .add-worker-form {
            margin-bottom: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 10px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .form-row input {
            flex: 1;
        }
        
        .error-message {
            color: #e53e3e;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .success-message {
            color: #38a169;
            font-size: 14px;
            margin-top: 5px;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .app-card {
                padding: 20px;
            }
            
            .attendance-row {
                grid-template-columns: 70px 70px 90px 1fr;
                gap: 8px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-card">
            <!-- Login Section -->
            <div id="loginSection" class="login-form">
                <div class="header">
                    <h1>‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</h1>
                    <p>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç</p>
                </div>
                
                <div class="form-group">
                    <label for="phoneNumber">‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞:</label>
                    <input type="tel" id="phoneNumber" placeholder="10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" maxlength="10">
                    <div id="phoneError" class="error-message"></div>
                </div>
                
                <button class="btn" id="sendOtpBtn" onclick="sendOTP()">OTP ‡§≠‡•á‡§ú‡•á‡§Ç</button>
                
                <div id="otpSection" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label for="otpInput">OTP ‡§°‡§æ‡§≤‡•á‡§Ç:</label>
                        <input type="text" id="otpInput" placeholder="6 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ OTP" maxlength="6">
                        <div id="otpError" class="error-message"></div>
                    </div>
                    <button class="btn" onclick="verifyOTP()">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
                </div>
            </div>

            <!-- Main Application -->
            <div id="mainApp" class="main-app hidden">
                <!-- Navigation -->
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showWorkerList()">‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§∏‡•Ç‡§ö‡•Ä</button>
                    <button class="nav-btn" onclick="showAttendance()">‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä</button>
                    <button class="nav-btn" onclick="logout()">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
                </div>

                <!-- Worker List Section -->
                <div id="workerListSection">
                    <div class="add-worker-form">
                        <h3 style="margin-bottom: 15px;">‡§®‡§Ø‡§æ ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h3>
                        <div class="form-row">
                            <input type="text" id="workerName" placeholder="‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ">
                            <input type="tel" id="workerPhone" placeholder="‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" maxlength="10">
                        </div>
                        <div class="form-row">
                            <input type="number" id="dailyWage" placeholder="‡§¶‡•à‡§®‡§ø‡§ï ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•Ä">
                        </div>
                        <button class="btn" onclick="addWorker()">‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</button>
                        <div id="workerMessage"></div>
                    </div>
                    
                    <div class="worker-list" id="workerList">
                        <!-- Workers will be listed here -->
                    </div>
                </div>

                <!-- Attendance Section -->
                <div id="attendanceSection" style="display: none;">
                    <div id="workerDetails">
                        <!-- Worker details and attendance will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let workers = [];
        let currentWorker = null;
        let attendanceData = {};

        // Initialize app
        function initApp() {
            loadWorkersFromStorage();
            loadAttendanceFromStorage();
        }

        // OTP Functions
        function sendOTP() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const phoneError = document.getElementById('phoneError');
            
            if (!phoneNumber || phoneNumber.length !== 10 || !/^\d{10}$/.test(phoneNumber)) {
                phoneError.textContent = '‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç';
                return;
            }
            
            phoneError.textContent = '';
            
            // Simulate sending OTP
            document.getElementById('otpSection').style.display = 'block';
            document.getElementById('sendOtpBtn').textContent = 'OTP ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ (‡§°‡•á‡§Æ‡•ã: 123456)';
            document.getElementById('sendOtpBtn').disabled = true;
            
            // For demo purposes, show the OTP
            setTimeout(() => {
                alert('‡§°‡•á‡§Æ‡•ã OTP: 123456');
            }, 1000);
        }

        function verifyOTP() {
            const otpInput = document.getElementById('otpInput').value;
            const otpError = document.getElementById('otpError');
            
            // For demo, accept 123456 as valid OTP
            if (otpInput === '123456') {
                otpError.textContent = '';
                showMainApp();
            } else {
                otpError.textContent = '‡§ó‡§≤‡§§ OTP, ‡§ï‡•É‡§™‡§Ø‡§æ 123456 ‡§°‡§æ‡§≤‡•á‡§Ç (‡§°‡•á‡§Æ‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è)';
            }
        }

        function showMainApp() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            initApp();
        }

        function logout() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            
            // Reset login form
            document.getElementById('phoneNumber').value = '';
            document.getElementById('otpInput').value = '';
            document.getElementById('otpSection').style.display = 'none';
            document.getElementById('sendOtpBtn').textContent = 'OTP ‡§≠‡•á‡§ú‡•á‡§Ç';
            document.getElementById('sendOtpBtn').disabled = false;
            document.getElementById('phoneError').textContent = '';
            document.getElementById('otpError').textContent = '';
        }

        // Navigation Functions
        function showWorkerList() {
            document.getElementById('workerListSection').style.display = 'block';
            document.getElementById('attendanceSection').style.display = 'none';
            updateNavButtons('workerList');
            renderWorkerList();
        }

        function showAttendance() {
            if (!currentWorker) {
                alert('‡§™‡§π‡§≤‡•á ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§∏‡•Ç‡§ö‡•Ä ‡§∏‡•á ‡§ï‡•ã‡§à ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ï‡•á ‡§®‡§æ‡§Æ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç)');
                showWorkerList();
                return;
            }
            
            document.getElementById('workerListSection').style.display = 'none';
            document.getElementById('attendanceSection').style.display = 'block';
            updateNavButtons('attendance');
            renderAttendanceSheet();
        }

        function updateNavButtons(active) {
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (active === 'workerList') {
                buttons[0].classList.add('active');
            } else if (active === 'attendance') {
                buttons[1].classList.add('active');
            }
        }

        // Worker Management Functions
        function addWorker() {
            const name = document.getElementById('workerName').value.trim();
            const phone = document.getElementById('workerPhone').value.trim();
            const wage = parseFloat(document.getElementById('dailyWage').value);
            const message = document.getElementById('workerMessage');
            
            if (!name || !wage || wage <= 0) {
                message.innerHTML = '<div class="error-message">‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§µ‡•à‡§ß ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•Ä ‡§°‡§æ‡§≤‡•á‡§Ç</div>';
                return;
            }
            
            if (phone && (phone.length !== 10 || !/^\d{10}$/.test(phone))) {
                message.innerHTML = '<div class="error-message">‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§π‡•Ä ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§°‡§æ‡§≤‡•á‡§Ç</div>';
                return;
            }
            
            const newWorker = {
                id: Date.now(),
                name: name,
                phone: phone || null,
                dailyWage: wage,
                createdDate: new Date().toISOString()
            };
            
            workers.push(newWorker);
            attendanceData[newWorker.id] = [];
            
            saveWorkersToStorage();
            saveAttendanceToStorage();
            
            document.getElementById('workerName').value = '';
            document.getElementById('workerPhone').value = '';
            document.getElementById('dailyWage').value = '';
            message.innerHTML = '<div class="success-message">‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ</div>';
            
            setTimeout(() => {
                message.innerHTML = '';
            }, 3000);
            
            renderWorkerList();
        }

        function selectWorker(workerId) {
            currentWorker = workers.find(w => w.id === workerId);
            
            // Update UI to show selected worker
            const workerItems = document.querySelectorAll('.worker-item');
            workerItems.forEach(item => item.classList.remove('active'));
            document.getElementById(`worker-${workerId}`).classList.add('active');
            
            // Show success message
            const message = document.getElementById('workerMessage');
            message.innerHTML = `<div class="success-message">${currentWorker.name} ‡§ö‡•Å‡§®‡§æ ‡§ó‡§Ø‡§æ‡•§ ‡§Ö‡§¨ ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä ‡§ü‡•à‡§¨ ‡§™‡§∞ ‡§ú‡§æ‡§è‡§Ç‡•§</div>`;
            
            setTimeout(() => {
                message.innerHTML = '';
            }, 3000);
        }

        function renderWorkerList() {
            const workerList = document.getElementById('workerList');
            
            if (workers.length === 0) {
                workerList.innerHTML = '<p style="text-align: center; color: #718096;">‡§ï‡•ã‡§à ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§</p>';
                return;
            }
            
            workerList.innerHTML = workers.map(worker => {
                const workerAttendance = attendanceData[worker.id] || [];
                const totalDays = workerAttendance.length;
                const totalAttendance = workerAttendance.reduce((sum, day) => sum + (day.attendance || 0), 0);
                const totalExpenses = workerAttendance.reduce((sum, day) => sum + (day.expense || 0), 0);
                const totalBalance = (totalAttendance * worker.dailyWage) - totalExpenses;
                
                return `
                    <div class="worker-item" id="worker-${worker.id}" onclick="selectWorker(${worker.id})" style="cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; font-size: 16px;">${worker.name}</div>
                                <div style="color: #718096; font-size: 14px;">‡§¶‡•à‡§®‡§ø‡§ï ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•Ä: ‚Çπ${worker.dailyWage}</div>
                                ${worker.phone ? `<div style="color: #667eea; font-size: 13px;">üì± ${worker.phone}</div>` : ''}
                                <div style="color: #667eea; font-size: 12px; margin-top: 5px;">üëÜ ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: #38a169; font-weight: bold; font-size: 18px;">‚Çπ${totalBalance}</div>
                                <div style="font-size: 12px; color: #718096;">${totalDays} ‡§¶‡§ø‡§®, ${totalAttendance} ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä</div>
                                ${worker.phone ? `<button onclick="sendNotification(${worker.id}); event.stopPropagation();" style="background: #48bb78; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; margin-top: 5px; cursor: pointer;">üìß SMS ‡§≠‡•á‡§ú‡•á‡§Ç</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Attendance Functions
        function renderAttendanceSheet() {
            if (!currentWorker) return;
            
            const workerDetails = document.getElementById('workerDetails');
            const workerAttendance = attendanceData[currentWorker.id] || [];
            
            // Calculate summary
            const totalDays = workerAttendance.length;
            const totalAttendance = workerAttendance.reduce((sum, day) => sum + (day.attendance || 0), 0);
            const totalExpenses = workerAttendance.reduce((sum, day) => sum + (day.expense || 0), 0);
            const totalEarned = totalAttendance * currentWorker.dailyWage;
            const totalBalance = totalEarned - totalExpenses;
            
            // Get last 15 days including today
            const last15Days = getLast15Days();
            
            workerDetails.innerHTML = `
                <div class="worker-header">
                    <div>
                        <div class="worker-name">${currentWorker.name}</div>
                        <div class="daily-wage">‡§¶‡•à‡§®‡§ø‡§ï ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•Ä: ‚Çπ${currentWorker.dailyWage}</div>
                        ${currentWorker.phone ? `<div style="color: #667eea; font-size: 14px;">üì± ${currentWorker.phone}</div>` : ''}
                    </div>
                    ${currentWorker.phone ? `<button onclick="sendNotification(${currentWorker.id})" style="background: #48bb78; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">üìß SMS ‡§≠‡•á‡§ú‡•á‡§Ç</button>` : ''}
                </div>
                
                <div style="background: #f7fafc; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                    <div style="display: grid; grid-template-columns: 80px 80px 100px 1fr; gap: 10px; font-weight: bold; font-size: 14px; color: #4a5568;">
                        <div>‡§§‡§æ‡§∞‡•Ä‡§ñ</div>
                        <div>‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä</div>
                        <div>‡§ñ‡§∞‡•ç‡§ö‡§æ</div>
                        <div style="text-align: right;">‡§¨‡•à‡§≤‡•á‡§Ç‡§∏</div>
                    </div>
                </div>
                
                <div style="max-height: 300px; overflow-y: auto;">
                    ${last15Days.map(date => {
                        const dateStr = date.toISOString().split('T')[0];
                        const existingRecord = workerAttendance.find(record => record.date === dateStr);
                        const attendance = existingRecord ? existingRecord.attendance : 0;
                        const expense = existingRecord ? existingRecord.expense : 0;
                        const dayBalance = (attendance * currentWorker.dailyWage) - expense;
                        
                        return `
                            <div class="attendance-row">
                                <div class="date-cell">${formatDate(date)}</div>
                                <div>
                                    <input type="number" 
                                           class="attendance-input" 
                                           value="${attendance}" 
                                           min="0" 
                                           max="2" 
                                           step="0.5"
                                           onchange="updateAttendance('${dateStr}', 'attendance', this.value)">
                                </div>
                                <div>
                                    <input type="number" 
                                           class="expense-input" 
                                           value="${expense}" 
                                           min="0"
                                           onchange="updateAttendance('${dateStr}', 'expense', this.value)">
                                </div>
                                <div class="balance-cell">‚Çπ${dayBalance}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
                
                <div class="summary-section">
                    <div class="summary-row">
                        <span>‡§ï‡•Å‡§≤ ‡§¶‡§ø‡§®:</span>
                        <span>${totalDays} ‡§¶‡§ø‡§®</span>
                    </div>
                    <div class="summary-row">
                        <span>‡§ï‡•Å‡§≤ ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä:</span>
                        <span>${totalAttendance}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡§ï‡•Å‡§≤ ‡§ï‡§Æ‡§æ‡§à:</span>
                        <span>‚Çπ${totalEarned}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö‡§æ:</span>
                        <span>‚Çπ${totalExpenses}</span>
                    </div>
                    <div class="summary-row">
                        <span>‡§ï‡•Å‡§≤ ‡§¨‡•à‡§≤‡•á‡§Ç‡§∏:</span>
                        <span>‚Çπ${totalBalance}</span>
                    </div>
                </div>
                
                <div class="payment-section">
                    <h4 style="margin-bottom: 15px;">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</h4>
                    <div class="payment-methods">
                        <button class="payment-btn active" onclick="selectPaymentMethod('cash')">‡§ï‡•à‡§∂</button>
                        <button class="payment-btn" onclick="selectPaymentMethod('upi')">UPI</button>
                    </div>
                    
                    <div>
                        <input type="number" id="paymentAmount" placeholder="‡§∞‡§æ‡§∂‡§ø ‡§°‡§æ‡§≤‡•á‡§Ç" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 5px; margin-bottom: 10px;">
                        <button class="btn" onclick="makePayment()" style="background: #38a169;">‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                    </div>
                    
                    <div id="upiSection" style="display: none; margin-top: 15px;">
                        <input type="text" id="upiId" placeholder="UPI ID (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï)" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 5px;">
                        <p style="font-size: 12px; color: #718096; margin-top: 5px;">UPI ID ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§§‡•ã ‡§ï‡•à‡§∂ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç</p>
                    </div>
                </div>
            `;
        }

        function updateAttendance(date, field, value) {
            if (!currentWorker) return;
            
            const workerAttendance = attendanceData[currentWorker.id] || [];
            let existingRecord = workerAttendance.find(record => record.date === date);
            
            if (!existingRecord) {
                existingRecord = { date: date, attendance: 0, expense: 0 };
                workerAttendance.push(existingRecord);
                attendanceData[currentWorker.id] = workerAttendance;
            }
            
            existingRecord[field] = parseFloat(value) || 0;
            
            saveAttendanceToStorage();
            renderAttendanceSheet(); // Re-render to update calculations
            
            // Auto-send notification if phone number exists and attendance is updated
            if (currentWorker.phone && field === 'attendance' && value > 0) {
                setTimeout(() => {
                    sendNotification(currentWorker.id, true); // true for auto notification
                }, 1000);
            }
        }

        function selectPaymentMethod(method) {
            const buttons = document.querySelectorAll('.payment-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const upiSection = document.getElementById('upiSection');
            if (method === 'upi') {
                upiSection.style.display = 'block';
            } else {
                upiSection.style.display = 'none';
            }
        }

        function makePayment() {
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const activePaymentMethod = document.querySelector('.payment-btn.active').textContent;
            
            if (!amount || amount <= 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡§∞‡§æ‡§∂‡§ø ‡§°‡§æ‡§≤‡•á‡§Ç');
                return;
            }
            
            if (activePaymentMethod === 'UPI') {
                const upiId = document.getElementById('upiId').value.trim();
                if (upiId) {
                    alert(`UPI ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü: ‚Çπ${amount}\nUPI ID: ${upiId}\n(‡§Ø‡§π ‡§°‡•á‡§Æ‡•ã ‡§π‡•à, ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§à)`);
                } else {
                    alert('UPI ID ‡§°‡§æ‡§≤‡•á‡§Ç ‡§Ø‡§æ ‡§ï‡•à‡§∂ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ö‡•Å‡§®‡•á‡§Ç');
                    return;
                }
            } else {
                alert(`‡§ï‡•à‡§∂ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü: ‚Çπ${amount}\n(‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§∞‡§ñ ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ)`);
            }
            
            // Record payment as expense for today
            const today = new Date().toISOString().split('T')[0];
            const workerAttendance = attendanceData[currentWorker.id] || [];
            let todayRecord = workerAttendance.find(record => record.date === today);
            
            if (!todayRecord) {
                todayRecord = { date: today, attendance: 0, expense: 0 };
                workerAttendance.push(todayRecord);
                attendanceData[currentWorker.id] = workerAttendance;
            }
            
            todayRecord.expense = (todayRecord.expense || 0) + amount;
            
            saveAttendanceToStorage();
            document.getElementById('paymentAmount').value = '';
            renderAttendanceSheet();
        }

        // Notification Functions
        function sendNotification(workerId, isAuto = false) {
            const worker = workers.find(w => w.id === workerId);
            if (!worker || !worker.phone) {
                alert('‡§á‡§∏ ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à');
                return;
            }
            
            const workerAttendance = attendanceData[worker.id] || [];
            const totalDays = workerAttendance.length;
            const totalAttendance = workerAttendance.reduce((sum, day) => sum + (day.attendance || 0), 0);
            const totalExpenses = workerAttendance.reduce((sum, day) => sum + (day.expense || 0), 0);
            const totalEarned = totalAttendance * worker.dailyWage;
            const totalBalance = totalEarned - totalExpenses;
            
            const today = new Date().toLocaleDateString('hi-IN');
            const todayRecord = workerAttendance.find(record => record.date === new Date().toISOString().split('T')[0]);
            const todayAttendance = todayRecord ? todayRecord.attendance : 0;
            const todayExpense = todayRecord ? todayRecord.expense : 0;
            
            const message = `
üèóÔ∏è ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü - ${worker.name}
üìÖ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${today}
‚è∞ ‡§Ü‡§ú ‡§ï‡•Ä ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä: ${todayAttendance} ‡§¶‡§ø‡§®
üí∞ ‡§Ü‡§ú ‡§ï‡§æ ‡§ñ‡§∞‡•ç‡§ö‡§æ: ‚Çπ${todayExpense}

üìä ‡§ï‡•Å‡§≤ ‡§µ‡§ø‡§µ‡§∞‡§£:
üìà ‡§ï‡•Å‡§≤ ‡§¶‡§ø‡§®: ${totalDays}
‚úÖ ‡§ï‡•Å‡§≤ ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä: ${totalAttendance} ‡§¶‡§ø‡§®
üíµ ‡§ï‡•Å‡§≤ ‡§ï‡§Æ‡§æ‡§à: ‚Çπ${totalEarned}
üõí ‡§ï‡•Å‡§≤ ‡§ñ‡§∞‡•ç‡§ö‡§æ: ‚Çπ${totalExpenses}
üí≥ ‡§∂‡•á‡§∑ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${totalBalance}

‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üôè
            `.trim();
            
            if (isAuto) {
                // Show auto notification popup
                showNotificationPopup(`üì± ‡§ë‡§ü‡•ã SMS ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!\n\n${worker.name} (${worker.phone}) ‡§ï‡•ã ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§æ SMS ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ‡•§`, 'success');
            } else {
                // Show manual notification with full message
                const confirmSend = confirm(`${worker.name} (${worker.phone}) ‡§ï‡•ã ‡§Ø‡§π SMS ‡§≠‡•á‡§ú‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?\n\n${message}`);
                
                if (confirmSend) {
                    showNotificationPopup(`üì± SMS ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!\n\n${worker.name} ‡§ï‡•ã ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§π‡§æ‡§ú‡§ø‡§∞‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à‡•§`, 'success');
                }
            }
        }
        
        function showNotificationPopup(message, type) {
            // Create popup element
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#48bb78' : '#f56565'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                max-width: 300px;
                font-size: 14px;
                line-height: 1.4;
                animation: slideIn 0.3s ease;
            `;
            
            popup.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>${message.replace(/\n/g, '<br>')}</div>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 18px; cursor: pointer; margin-left: 10px;">√ó</button>
                </div>
            `;
            
            // Add animation CSS
            if (!document.getElementById('notificationCSS')) {
                const style = document.createElement('style');
                style.id = 'notificationCSS';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(popup);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (popup.parentElement) {
                    popup.remove();
                }
            }, 5000);
        }
        function getLast15Days() {
            const days = [];
            const today = new Date();
            
            for (let i = 14; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                days.push(date);
            }
            
            return days;
        }

        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            return `${day}/${month}`;
        }

        // Storage Functions
        function saveWorkersToStorage() {
            const data = { workers: workers };
            window.workersData = data;
        }

        function loadWorkersFromStorage() {
            if (window.workersData) {
                workers = window.workersData.workers || [];
            }
        }

        function saveAttendanceToStorage() {
            const data = { attendanceData: attendanceData };
            window.attendanceDataStore = data;
        }

        function loadAttendanceFromStorage() {
            if (window.attendanceDataStore) {
                attendanceData = window.attendanceDataStore.attendanceData || {};
            }
        }

        // Initialize with demo data if no workers exist
        function initializeDemoData() {
            if (workers.length === 0) {
                const demoWorker = {
                    id: Date.now(),
                    name: "‡§∞‡§æ‡§Æ ‡§ï‡•Å‡§Æ‡§æ‡§∞",
                    phone: "9876543210",
                    dailyWage: 500,
                    createdDate: new Date().toISOString()
                };
                
                workers.push(demoWorker);
                attendanceData[demoWorker.id] = [
                    { date: new Date().toISOString().split('T')[0], attendance: 1, expense: 0 }
                ];
                
                saveWorkersToStorage();
                saveAttendanceToStorage();
            }
        }

        // Utility Functions

        // Initialize demo data when app loads
        window.onload = function() {
            setTimeout(initializeDemoData, 1000);
        };
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .salary-box {
            background: #e3ffe3;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <!-- Language Change -->
    <div style="text-align:right;">
        <label for="language">üåê Language:</label>
        <select id="language" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
        </select>
    </div>

    <h1 id="titleText">Worker Management System</h1>

    <div class="container">
        <form>
            <label id="nameLabel" for="name">Name:</label>
            <input type="text" id="name" placeholder="Enter worker name">

            <label id="workLabel" for="work">Work Type:</label>
            <input type="text" id="work" placeholder="Enter work type">

            <!-- Monthly Salary Fixed -->
            <label id="salaryLabel" for="salary">Monthly Salary:</label>
            <input type="number" id="salary" value="15000" readonly>
            <div class="salary-box" id="salaryText">Fixed Salary: ‚Çπ15000</div>

            <button type="submit" id="submitBtn">Submit</button>
        </form>
    </div>

<script>
function changeLanguage() {
    let lang = document.getElementById("language").value;

    if(lang === "hi"){
        document.getElementById("titleText").innerText = "‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ";
        document.getElementById("nameLabel").innerText = "‡§®‡§æ‡§Æ:";
        document.getElementById("workLabel").innerText = "‡§ï‡§æ‡§Æ ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:";
        document.getElementById("salaryLabel").innerText = "‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§µ‡•á‡§§‡§®:";
        document.getElementById("salaryText").innerText = "‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§µ‡•á‡§§‡§®: ‚Çπ15000";
        document.getElementById("submitBtn").innerText = "‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç";
    } else {
        document.getElementById("titleText").innerText = "Worker Management System";
        document.getElementById("nameLabel").innerText = "Name:";
        document.getElementById("workLabel").innerText = "Work Type:";
        document.getElementById("salaryLabel").innerText = "Monthly Salary:";
        document.getElementById("salaryText").innerText = "Fixed Salary: ‚Çπ15000";
        document.getElementById("submitBtn").innerText = "Submit";
    }
}
</script>

</body>
</html>
